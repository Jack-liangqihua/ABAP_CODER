REPORT Z_LEARN_RESTFUL.


DATA: JSON_SER TYPE REF TO CL_TREX_JSON_SERIALIZER,
      JSON_DES TYPE REF TO CL_TREX_JSON_DESERIALIZER.

DATA: LV_URL     TYPE STRING, "http 服务接口地址
      LV_URL_PAR TYPE STRING. "http 服务接口地址
DATA: LO_HTTP_CLIENT  TYPE REF TO IF_HTTP_CLIENT.

DATA: LV_LEN TYPE I."发送报文长度
DATA: LV_RESPON TYPE STRING.
DATA: LV_SUBRC TYPE SY-SUBRC.
DATA: LV_JSON_STR TYPE STRING. "发送报文
DATA: LV_MSGTY TYPE C,
      LV_MSGTX TYPE STRING.

DATA: LT_JSON TYPE STANDARD TABLE OF VBAK,
      LS_JSON TYPE VBAK.

* 设置HTTP接口地址
LV_URL_PAR = '"a我会很好b"'.
CALL METHOD CL_HTTP_CLIENT=>IF_HTTP_CLIENT~ESCAPE_URL
  EXPORTING
    UNESCAPED = LV_URL_PAR
  RECEIVING
    ESCAPED   = LV_URL_PAR.
LV_URL = 'http://172.16.8.49:8080/helloworld/?name='.
CONCATENATE  LV_URL  LV_URL_PAR INTO LV_URL.





"实例化1个 IF_HTTP_CLIENT 的对象得到HTTP_CLIENT
CL_HTTP_CLIENT=>CREATE_BY_URL(
           EXPORTING URL    = LV_URL                "输入参数
           IMPORTING CLIENT = LO_HTTP_CLIENT ).

LO_HTTP_CLIENT->PROPERTYTYPE_LOGON_POPUP = LO_HTTP_CLIENT->CO_DISABLED.
CALL METHOD LO_HTTP_CLIENT->AUTHENTICATE(
  EXPORTING
*   client   = ''
*   proxy_authentication = 'X'
    USERNAME = ''
    PASSWORD = ''
*   LANGUAGE = 'E'
               ).

"设置某个特定的header field的值
LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD(
        EXPORTING
             NAME  = '~SERVER_PROTOCOL'
             VALUE = 'HTTP/1.1' ).

"设置某个特定的header field的值
*CALL METHOD LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD
*  EXPORTING
*    NAME  = 'CONTENT-TYPE'
*    VALUE = 'APPLICATION/JSON'.
CALL METHOD LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD
  EXPORTING
    NAME  = 'Content-Type'
    VALUE = 'application/JSON; charset=utf-8'.
"设置某个特定的header field的值
LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD(
      EXPORTING
           NAME  = 'ACCEPT'
           VALUE = '*/*' ).

"设置http请求的方法GET 或者 POST
CALL METHOD LO_HTTP_CLIENT->REQUEST->SET_METHOD( 'POST' ).
"设置http body
DATA S_BODYDATA TYPE STRING VALUE 'ABC'.
CALL METHOD LO_HTTP_CLIENT->REQUEST->SET_CDATA
  EXPORTING
    DATA = S_BODYDATA.                             "输入参数
"dispatch of data
CALL METHOD LO_HTTP_CLIENT->SEND
  EXCEPTIONS
    HTTP_COMMUNICATION_FAILURE = 1
    HTTP_INVALID_STATE         = 2.


"receipt of http response
CALL METHOD LO_HTTP_CLIENT->RECEIVE
  EXCEPTIONS
    HTTP_COMMUNICATION_FAILURE = 1
    HTTP_INVALID_STATE         = 2
    HTTP_PROCESSING_FAILED     = 3.

CASE  SY-SUBRC .
  WHEN 1.
  WHEN 2.
  WHEN 3.
  WHEN OTHERS.
ENDCASE.

"获取response中的http的body内容
DATA GV_JSON TYPE STRING.
GV_JSON = LO_HTTP_CLIENT->RESPONSE->GET_CDATA( ).  "执行结果
WRITE GV_JSON.




*JSON数据转为内表数据


DATA :LS_MSG TYPE ZITMSG,
      LT_MSG TYPE STANDARD TABLE OF ZITMSG.

CALL METHOD /UI2/CL_JSON=>DESERIALIZE
  EXPORTING
    JSON = GV_JSON
*   PRETTY_NAME = ABAP_FALSE
  CHANGING
    DATA = LS_MSG.



"关闭http链接
CALL METHOD LO_HTTP_CLIENT->CLOSE.